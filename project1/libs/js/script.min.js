$(window).on("load",function(){$("#preloader").length&&$("#preloader").delay(100).fadeOut("slow",function(){$(this).remove()})}),$(document).ready(function(){"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(function(t){let e,a;null!==t.coords.latitude&&null!==t.coords.longitude?(e=t.coords.latitude,a=t.coords.longitude):(e=51.509865,a=-.118092);let o=L.map("map").setView([e,a],13);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(o);let n,r=L.icon({iconUrl:"https://shomadutt.com/project1/libs/Leaflet/images/globe.png",shadowUrl:"https://shomadutt.com/project1/libs/Leaflet/images/globeShadow.png",iconSize:[60,95],shadowSize:[50,64],iconAnchor:[22,94],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),s=L.marker([e,a],{icon:r}).bindPopup("Your location").addTo(o);$.ajax({url:"libs/php/getOpenCage.php",type:"POST",dataType:"json",data:{q:String(e)+","+String(a)},success:function(t){"ok"==t.status.name&&$.ajax({url:"libs/php/getCountryBorders.php",type:"POST",dataType:"json",data:"{}",success:function(d){if("ok"==d.status.name){d.data.sort((t,e)=>t.properties.name>e.properties.name?1:t.properties.name<e.properties.name?-1:0);for(let u=0;u<d.data.length;u++)if($("#selectCountry").append(`<option value="${d.data[u].properties.iso_a2}">${d.data[u].properties.name}</option>`),d.data[u].properties.iso_a2===t.data.results[0].components.country_code.toUpperCase()){n=L.geoJson(d.data[u].geometry),n.addTo(o);let p=L.markerClusterGroup();p.addLayer(L.marker([51.510357,-.116773],{icon:r}).bindPopup("Big Ben")),p.addLayer(L.marker([51.503399,-.119519],{icon:r}).bindPopup("London Eye")),p.addLayer(L.marker([51.502777,-.15125],{icon:r}).bindPopup("Hyde Park Corner")),p.addLayer(L.marker([51.501476,-.140634],{icon:r}).bindPopup("Buckingham Palace")),p.addLayer(L.marker([51.4967,-.1764],{icon:r}).bindPopup("Natural History Museum")),p.addLayer(L.marker([51.49829,-.13153],{icon:r}).bindPopup("Westminster Abbey")),p.addLayer(L.marker([51.51218,-.09199],{icon:r}).bindPopup("Tower Of London")),p.addLayer(L.marker([51.496639,-.17218],{icon:r}).bindPopup("Victoria And Albert Museum")),p.addLayer(L.marker([51.508972,-.128794],{icon:r}).bindPopup("National Gallery")),p.addLayer(L.marker([51.518757,-.126168],{icon:r}).bindPopup("British Museum")),o.addLayer(p);L.popup().setLatLng([e,a]).setContent("House number: "+t.data.results[0].components.house_number+"<br>Post code: "+t.data.results[0].components.postcode+"<br>Road: "+t.data.results[0].components.road+"<br>State: "+t.data.results[0].components.state+"<br>State code: "+t.data.results[0].components.state_code+"<br>State district: "+t.data.results[0].components.state_district+"<br>Suburb: "+t.data.results[0].components.suburb+"<br>Capital: "+t.data.results[0].components.city+"<br>City district: "+t.data.results[0].components.city_district+"<br>Continent: "+t.data.results[0].components.continent+"<br>Country: "+t.data.results[0].components.country+"<br>Country code: "+t.data.results[0].components.country_code).openOn(o);function i(){let r,i=L.popup().setLatLng([e,a]).setContent("House number: "+t.data.results[0].components.house_number+"<br>Post code: "+t.data.results[0].components.postcode+"<br>Road: "+t.data.results[0].components.road+"<br>State: "+t.data.results[0].components.state+"<br>State code: "+t.data.results[0].components.state_code+"<br>State district: "+t.data.results[0].components.state_district+"<br>Suburb: "+t.data.results[0].components.suburb+"<br>Capital: "+t.data.results[0].components.city+"<br>City district: "+t.data.results[0].components.city_district+"<br>Continent: "+t.data.results[0].components.continent+"<br>Country: "+t.data.results[0].components.country+"<br>Country code: "+t.data.results[0].components.country_code);L.easyButton("fa-globe",function(t,o){o.removeLayer(n),n=L.geoJson(d.data[u].geometry),n.addTo(o),o.fitBounds(n.getBounds()),o.removeLayer(s)&&o.addLayer(s),r=t,r.button.style.backgroundColor="#007bff",i.setLatLng([e,a]).openOn(o)}).addTo(o)}i();for(let t=0;t<d.data.length;t++)$("#selectCountryInfo").click(function(){$("#selectCountry").val()===d.data[t].properties.iso_a2&&(o.removeLayer(n),o.removeLayer(s),n=L.geoJson(d.data[t].geometry),n.addTo(o),o.fitBounds(n.getBounds()),$.ajax({url:"libs/php/getCountryInfo.php",type:"POST",dataType:"json",data:{countryCode:$("#selectCountry").val()},success:function(t){if("ok"==t.status.name){let e=n.getBounds().getCenter();L.popup().setLatLng(e).setContent("Capital: "+t.data[0].capital+"<br>Continent: "+t.data[0].continent+"<br>Continent name: "+t.data[0].continentName+"<br>Country name: "+t.data[0].countryName+"<br>Currency code: "+t.data[0].currencyCode+"<br>Languages: "+t.data[0].languages+"<br>North: "+t.data[0].north+"<br>East: "+t.data[0].east+"<br>South: "+t.data[0].south+"<br>West: "+t.data[0].west+"<br>Population: "+t.data[0].population).openOn(o)}}}))}),$("#selectCountryWeather").click(function(){if($("#selectCountry").val()===d.data[t].properties.iso_a2){o.removeLayer(n),o.removeLayer(s),n=L.geoJson(d.data[t].geometry),n.addTo(o),o.fitBounds(n.getBounds());let e=n.getBounds().getCenter();console.log(e),$.ajax({url:"libs/php/getOpenWeather.php",type:"POST",dataType:"json",data:{lon:e.lng,lat:e.lat},success:function(t){if("ok"==t.status.name){L.popup().setLatLng(e).setContent("Weather description: "+t.data.weather[0].description+"<br>Temperature: "+t.data.main.temp+"<br>Feels like: "+t.data.main.feels_like+"<br>Minimum temperature: "+t.data.main.temp_min+"<br>Maximum temperature: "+t.data.main.temp_max+"<br>Pressure: "+t.data.main.pressure+"<br>Humidity: "+t.data.main.humidity+"<br>Visibility: "+t.data.visibility+"<br>Wind speed: "+t.data.wind.speed+"<br>Wind temperature: "+t.data.wind.deg+"<br>Clouds: "+t.data.clouds.all+"<br>Sunrise: "+t.data.sys.sunrise+"<br>Sunset: "+t.data.sys.sunset+"<br>Timezone: "+t.data.timezone).openOn(o)}}})}}),$("#selectCountryWiki").click(function(){if($("#selectCountry").val()===d.data[t].properties.iso_a2){o.removeLayer(n),o.removeLayer(s),n=L.geoJson(d.data[t].geometry),n.addTo(o),o.fitBounds(n.getBounds());let e=n.getBounds().getCenter();console.log(e),$.ajax({url:"libs/php/getGeonamesWiki.php",type:"POST",dataType:"json",data:{lat:e.lat,lng:e.lng},success:function(t){if("ok"==t.status.name){L.popup().setLatLng(e).setContent("Wikipedia summary: "+t.data[0].summary+"<br>Wikipedia URL: "+t.data[0].wikipediaUrl+"<br>Distance: "+t.data[0].distance).openOn(o)}}})}}),$("#selectHolidayInfo").click(function(){$("#selectCountry").val()===d.data[t].properties.iso_a2&&(o.removeLayer(n),o.removeLayer(s),n=L.geoJson(d.data[t].geometry),n.addTo(o),o.fitBounds(n.getBounds()),$.ajax({url:"libs/php/getHolidayInfo.php",type:"POST",dataType:"json",data:{countryCode:$("#selectCountry").val()},success:function(t){if("ok"==t.status.name){function e(){let e=[];for(let a=0;a<t.data.length;a++){let o=t.data[a].date+" "+t.data[a].localName;e.push(o)}return e}let a=e().join(" <br>"),r=n.getBounds().getCenter();L.popup().setLatLng(r).setContent(a).openOn(o)}}}))}),$("#selectIncomeInfo").click(function(){$("#selectCountry").val()===d.data[t].properties.iso_a2&&(o.removeLayer(n),o.removeLayer(s),n=L.geoJson(d.data[t].geometry),n.addTo(o),o.fitBounds(n.getBounds()),$.ajax({url:"libs/php/getIncomeInfo.php",type:"POST",dataType:"json",data:{countryCode:$("#selectCountry").val()},success:function(t){if("ok"==t.status.name){let e=n.getBounds().getCenter();L.popup().setLatLng(e).setContent("Income level: "+t.data[1][0].incomeLevel.value).openOn(o)}}}))}),$("#selectFlag").click(function(){$("#selectCountry").val()===d.data[t].properties.iso_a2&&(o.removeLayer(n),o.removeLayer(s),n=L.geoJson(d.data[t].geometry),n.addTo(o),o.fitBounds(n.getBounds()),$.ajax({url:"libs/php/getCountryFlag.php",type:"POST",dataType:"json",data:{countryCode:$("#selectCountry").val()},success:function(t){if("ok"==t.status.name){let e=n.getBounds().getCenter(),a=`<img class="flag" src=${t.data.flag} />`;L.popup().setLatLng(e).setContent(a).openOn(o)}}}))}),$("#selectCoronaInfo").click(function(){$("#selectCountry").val()===d.data[t].properties.iso_a2&&(o.removeLayer(n),o.removeLayer(s),n=L.geoJson(d.data[t].geometry),n.addTo(o),o.fitBounds(n.getBounds()),$.ajax({url:"libs/php/getCoronaInfo.php",type:"POST",dataType:"json",data:{countryCode:$("#selectCountry").val()},success:function(t){if("ok"==t.status.name){let e=n.getBounds().getCenter();L.popup().setLatLng(e).setContent("Updated at: "+t.data.data.updated_at+"<br>Deaths today: "+t.data.data.today.deaths+"<br>Confirmed today: "+t.data.data.today.confirmed+"<br>Deaths: "+t.data.data.latest_data.deaths+"<br>Confirmed deaths: "+t.data.data.latest_data.confirmed+"<br>Recovered: "+t.data.data.latest_data.recovered+"<br>Critical: "+t.data.data.latest_data.critical+"<br>Calculated death rate: "+t.data.data.latest_data.calculated.death_rate+"<br>Calculated recovery rate: "+t.data.data.latest_data.calculated.death_rate+"<br>Calculated cases per million population: "+t.data.data.latest_data.calculated.cases_per_million_population).openOn(o)}}}))})}}}})}})})});