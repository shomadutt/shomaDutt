$(window).on("load",function(){$("#preloader").length&&$("#preloader").delay(100).fadeOut("slow",function(){$(this).remove()})}),$(document).ready(function(){$.ajax({type:"POST",url:"libs/php/names.php",dataType:"json",success:function(t){$("#selectCountry").html(""),$.each(t.data,function(a){$("#selectCountry").append($("<option>",{value:t.data[a].code,text:t.data[a].name}))})}});let t,a,e=L.map("map");L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(e),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(function(e){t=e.coords.latitude,a=e.coords.longitude,$.ajax({url:"libs/php/openCage.php",type:"POST",dataType:"json",data:{q:String(t)+","+String(a)},success:function(t){"ok"==t.status.name&&$("#selectCountry").val(t.data.results[0].components.country_code.toUpperCase()).trigger("change")}})}),$("#selectCountry").change(function(){$.ajax({type:"POST",url:"libs/php/borders.php",dataType:"json",success:function(t){$.each(t.data,function(a){if($("#selectCountry").val()===t.data[a].code){let n={color:"#ff9966",weight:3,opacity:.9,fillOpacity:.5},o=L.geoJSON(t.data[a].border,{style:n}).addTo(e);e.fitBounds(o.getBounds())}})}}),$.ajax({url:"libs/php/countryInfo.php",type:"POST",dataType:"json",data:{countryCode:$("#selectCountry").val()},success:function(t){"ok"==t.status.name&&($("#infoHeading").empty(),$("#infoHeading").append($("#selectCountry option:selected").text()),$("#txtCapital").html(t.data[0].capital),$("#txtContinent").html(t.data[0].continent),$("#txtContinentName").html(t.data[0].continentName),$("#txtCountryName").html(t.data[0].countryName),$.ajax({url:"libs/php/countryFlag.php",type:"POST",dataType:"json",data:{countryCode:$("#selectCountry").val()},success:function(t){"ok"==t.status.name&&$("#txtFlag").html(`<img class="flag" src=${t.data.flag} />`)}}),$("#txtCurrencyCode").html(t.data[0].currencyCode),$.ajax({url:"libs/php/incomeInfo.php",type:"POST",dataType:"json",data:{countryCode:$("#selectCountry").val()},success:function(t){if("ok"==t.status.name){let a=t.data[1][0].incomeLevel.value;$("#txtIncome").html(a)}}}),t.data[0].population<1e6?$("#txtPopulation").html(parseInt(t.data[0].population/1e3)+" thousand"):$("#txtPopulation").html(parseInt(t.data[0].population/1e6)+" million"))}}),$.ajax({url:"libs/php/countryInfo.php",type:"POST",dataType:"json",data:{countryCode:$("#selectCountry").val()},success:function(t){"ok"==t.status.name&&$.ajax({url:"libs/php/rateInfo.php",type:"POST",dataType:"json",data:{currencyCode:t.data[0].currencyCode},success:function(t){"ok"==t.status.name&&($("#rateHeading").empty(),$("#rateHeading").append("Exchange Rates of "+$("#selectCountry option:selected").text()),$("#txtUSD").html(t.data.conversion_rates.USD),$("#txtEUR").html(t.data.conversion_rates.EUR),$("#txtYEN").html(t.data.conversion_rates.JPY),$("#txtGBP").html(t.data.conversion_rates.GBP),$("#txtAUD").html(t.data.conversion_rates.AUD),$("#txtCAD").html(t.data.conversion_rates.CAD),$("#txtCHF").html(t.data.conversion_rates.CHF),$("#txtCNY").html(t.data.conversion_rates.CNY),$("#txtSEK").html(t.data.conversion_rates.SEK),$("#txtNZD").html(t.data.conversion_rates.NZD))}})}});let t=$("#selectCountry option:selected").text().replace(" ","%20");$.ajax({url:"libs/php/uniInfo.php",type:"POST",dataType:"json",data:{country:t},success:function(t){$("#uniHeading").empty(),$("#uniHeading").append("Universities in "+$("#selectCountry option:selected").text()),$("#uniTable").html(""),$.each(t.data,function(a){let e="<tr><td>"+t.data[a].name+"</td><td>"+t.data[a].web_pages+"</td></tr>";$("#uniTable").append(e)})}}),$.ajax({url:"libs/php/countryInfo.php",type:"POST",dataType:"json",data:{countryCode:$("#selectCountry").val()},success:function(t){$.ajax({url:"libs/php/openCage.php",type:"POST",dataType:"json",data:{q:t.data[0].capital},success:function(a){"ok"==a.status.name&&$.ajax({url:"libs/php/weatherForecast.php",type:"POST",dataType:"json",data:{lat:a.data.results[0].geometry.lat,lon:a.data.results[0].geometry.lng},success:function(a){if("ok"==a.status.name){$("#location").html(t.data[0].capital),$("#maxTempToday").html(parseInt(a.data.daily[0].temp.max-273.15)+"°"),$("#minTempToday").html(parseInt(a.data.daily[0].temp.min-273.15)+"°");let e,n=a.data.daily[0].weather[0].description;n=n.substring(0,1).toUpperCase()+n.substring(1,n.length),$("#descriptionToday").html(n),e="http://openweathermap.org/img/wn/"+a.data.daily[0].weather[0].icon+"@2x.png",$("#iconToday").html("<img src='"+e+"'>");let o=new Date,d=new Date(o);d.setDate(d.getDate()+1);let s=function(t){if(t>3&&t<21)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},l=d.getDay(),r={0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"};for(let t in r)t==l&&$("#dateDay1").html(r[t].substring(0,3)+" "+d.getDate()+s(d.getDate()));$("#maxTempDay1").html(parseInt(a.data.daily[1].temp.max-273.15)+"°"),$("#minTempDay1").html(parseInt(a.data.daily[1].temp.min-273.15)+"°"),e="http://openweathermap.org/img/wn/"+a.data.daily[1].weather[0].icon+"@2x.png",$("#iconDay1").html("<img src='"+e+"'>");let i=new Date(o);i.setDate(i.getDate()+2),l=i.getDay();for(let t in r)t==l&&$("#dateDay2").html(r[t].substring(0,3)+" "+i.getDate()+s(i.getDate()));$("#maxTempDay2").html(parseInt(a.data.daily[2].temp.max-273.15)+"°"),$("#minTempDay2").html(parseInt(a.data.daily[2].temp.min-273.15)+"°"),e="http://openweathermap.org/img/wn/"+a.data.daily[2].weather[0].icon+"@2x.png",$("#iconDay2").html("<img src='"+e+"'>");let c=new Date(o);c.setDate(c.getDate()+3),l=c.getDay();for(let t in r)t==l&&$("#dateDay3").html(r[t].substring(0,3)+" "+c.getDate()+s(c.getDate()));$("#maxTempDay3").html(parseInt(a.data.daily[3].temp.max-273.15)+"°"),$("#minTempDay3").html(parseInt(a.data.daily[3].temp.min-273.15)+"°"),e="http://openweathermap.org/img/wn/"+a.data.daily[3].weather[0].icon+"@2x.png",$("#iconDay3").html("<img src='"+e+"'>");let p=new Date(o);p.setDate(p.getDate()+4),l=p.getDay();for(let t in r)t==l&&$("#dateDay4").html(r[t].substring(0,3)+" "+p.getDate()+s(p.getDate()));$("#maxTempDay4").html(parseInt(a.data.daily[4].temp.max-273.15)+"°"),$("#minTempDay4").html(parseInt(a.data.daily[4].temp.min-273.15)+"°"),e="http://openweathermap.org/img/wn/"+a.data.daily[4].weather[0].icon+"@2x.png",$("#iconDay4").html("<img src='"+e+"'>")}}})}})}}),$.ajax({url:"libs/php/holidayInfo.php",type:"POST",dataType:"json",data:{year:2021,countryCode:$("#selectCountry").val()},success:function(t){$("#holidayHeading").empty(),$("#holidayHeading").append("Holidays in "+$("#selectCountry option:selected").text()),$("#holidayTable").html(""),$.each(t,function(a){let e=t[a].date;console.log(e);let n={"01":"January","02":"February","03":"March","04":"April","05":"May","06":"June","07":"July","08":"August","09":"September",10:"October",11:"November",12:"December"},o=e.slice(5,7);for(let t in n)t===o&&(e=e.slice(8,10)+" "+n[t]+" "+e.slice(0,4));let d="<tr><td>"+e+"</td><td>"+t[a].localName+"</td></tr>";$("#holidayTable").append(d)})}}),$.ajax({url:"libs/php/countryInfo.php",type:"POST",dataType:"json",data:{countryCode:$("#selectCountry").val()},success:function(t){$.ajax({url:"libs/php/earthquakeInfo.php",type:"POST",dataType:"json",data:{north:t.data[0].north,south:t.data[0].south,east:t.data[0].east,west:t.data[0].west},success:function(t){$("#earthquakeHeading").empty(),$("#earthquakeHeading").append("Earthquakes (magnitude) in "+$("#selectCountry option:selected").text()),$("#earthquakeTable").html(""),$.each(t.data.earthquakes,function(a){let e=t.data.earthquakes[a].datetime,n={"01":"January","02":"February","03":"March","04":"April","05":"May","06":"June","07":"July","08":"August","09":"September",10:"October",11:"November",12:"December"},o=e.slice(5,7);for(let t in n)t===o&&(e=e.slice(8,10)+" "+n[t]+" "+e.slice(0,4));let d="<tr><td>"+e+"</td><td>"+t.data.earthquakes[a].magnitude+"</td></tr>";$("#earthquakeTable").append(d)})}})}}),$.ajax({url:"libs/php/coronaInfo.php",type:"POST",dataType:"json",data:{countryCode:$("#selectCountry").val()},success:function(t){if("ok"==t.status.name){$("#coronaHeading").empty(),$("#coronaHeading").append("Coronavirus Statistics of "+$("#selectCountry option:selected").text());let a=t.data.data.updated_at.slice(0,10),e={"01":"January","02":"February","03":"March","04":"April","05":"May","06":"June","07":"July","08":"August","09":"September",10:"October",11:"November",12:"December"},n=a.slice(5,7);for(let t in e)t===n&&(a=a.slice(8,10)+" "+e[t]+" "+a.slice(0,4),$("#txtUpdatedOn").html(a));$("#txtDeathsToday").html(t.data.data.today.deaths.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),$("#txtDeaths").html(t.data.data.latest_data.deaths.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),$("#txtRecovered").html(t.data.data.latest_data.recovered.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),$("#txtCritical").html(t.data.data.latest_data.critical.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),$("#txtDeathRate").html(t.data.data.latest_data.calculated.death_rate.toString().slice(0,4)),$("#txtRecovRate").html(t.data.data.latest_data.calculated.recovery_rate.toString().slice(0,5)),$("#txtPerMil").html(t.data.data.latest_data.calculated.cases_per_million_population)}}}),$.ajax({url:"libs/php/cityInfo.php",type:"POST",dataType:"json",data:{countryCode:$("#selectCountry").val()},success:function(t){let a=L.ExtraMarkers.icon({icon:"fa-map-marker",iconColor:"#a8cd9c",markerColor:"#00b386",svg:!0,shape:"circle",prefix:"fa"}),n=L.markerClusterGroup();$.each(t.cities,function(e){n.addLayer(L.marker(new L.LatLng(t.cities[e].latitude,t.cities[e].longitude),{icon:a}).bindPopup(t.cities[e].name))}),e.addLayer(n)}})}),L.easyButton("fa-landmark",function(t,a){$("#infoModal").modal("show")}).addTo(e),L.easyButton("fa-dice-d20",function(t,a){$("#rateModal").modal("show")}).addTo(e),L.easyButton("fa-graduation-cap",function(t,a){$("#uniModal").modal("show")}).addTo(e),L.easyButton("fa-cloud-moon-rain",function(t,a){$("#weatherModal").modal("show")}).addTo(e),L.easyButton("fa-candy-cane",function(t,a){$("#holidayModal").modal("show")}).addTo(e),L.easyButton("fa-exclamation-triangle",function(t,a){$("#earthquakeModal").modal("show")}).addTo(e),L.easyButton("fa-head-side-mask",function(t,a){$("#coronaModal").modal("show")}).addTo(e)});